class Bubble{constructor(element){this.root=element;let heading_list=element.getElementsByClassName("bubble-heading");if(1!=heading_list.length)throw new Error("Invalid bubble element");this.headingElement=heading_list[0];let text_list=element.getElementsByClassName("bubble-text");if(1!=text_list.length)throw new Error("Invalid bubble element");if(this.textElement=text_list[0],this.buttonElements=element.getElementsByClassName("bubble-button"),this.buttonElements.length<1)throw new Error("Invalid bubble element");for(let i=0;i<this.buttonElements.length;i++)new mdc.ripple.MDCRipple(this.buttonElements[i]),this.buttonElements[i].addEventListener("click",e=>{let res={value:this.buttonElements[i].innerText,event:e};this.root.style.opacity="0",this.closeListeners.forEach(fn=>{fn(res)})});let pointer_list=element.getElementsByClassName("bubble-pointer");if(1!=pointer_list.length)throw new Error("Invalid bubble element");this.pointerElement=pointer_list[0],this.closeListeners=[],this.openListeners=[]}setHeading(text){this.headingElement.innerHTML=text,this.pointerElement.style.top=root.offsetHeight+"px",this.pointerElement.style.left=(root.offsetWidth-this.pointerElement.offsetWidth)/2+"px"}setText(text){this.textElement.innerHTML=text,this.pointerElement.style.top=root.offsetHeight+"px",this.pointerElement.style.left=(root.offsetWidth-this.pointerElement.offsetWidth)/2+"px"}listen(event,callback){if("Bubble:closed"===event)this.closeListeners.push(callback);else{if("Bubble:opened"!=event)throw new Error("Unknown event");this.openListeners.push(callback)}}unlisten(event,callback){if("Bubble:closed"===event){let index=this.closeListeners.indexOf(callback);if(-1===index)throw new Error("Unknown callback function");this.closeListeners.splice(index,1)}else{if("Bubble:opened"!=event)throw new Error("Unknown event");{let index=this.openListeners.indexOf(callback);if(-1===index)throw new Error("Unknown callback function");this.openListeners.splice(index,1)}}}show(element,offsetLeft=0){let root=this.root;function getOffsetLeft(elem){let offsetLeft=0;do{isNaN(elem.offsetLeft)||(offsetLeft+=elem.offsetLeft)}while(elem=elem.offsetParent);return offsetLeft}function getOffsetTop(elem){let offsetTop=0;do{isNaN(elem.offsetTop)||(offsetTop+=elem.offsetTop)}while(elem=elem.offsetParent);return offsetTop}let elem_left=getOffsetLeft(element),elem_top=getOffsetTop(element);function canPlaceAbove(){return elem_top>root.offsetHeight}function canPlaceBelow(){let vh;return Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)-(elem_top+element.offsetHeight)>root.offsetHeight}function canPlaceLeft(){return elem_left>root.offsetWidth}function canPlaceRight(){let vw;return Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)-(elem_left+element.offsetWidth)>root.offsetWidth}if(this.pointerElement.className="bubble-pointer",canPlaceAbove())console.debug("Placing above"),root.style.top=elem_top-root.offsetHeight-20+"px",root.style.left=(element.offsetWidth-root.offsetWidth)/2+elem_left+offsetLeft+"px",this.pointerElement.classList.add("bottom"),this.pointerElement.style.top=root.offsetHeight+"px",this.pointerElement.style.left=(root.offsetWidth-this.pointerElement.offsetWidth)/2-offsetLeft+"px";else if(canPlaceBelow())console.debug("Placing below"),root.style.top=elem_top+element.offsetHeight+20+"px",root.style.left=(element.offsetWidth-root.offsetWidth)/2+elem_left+offsetLeft+"px",this.pointerElement.style.top=root.offsetHeight+"px",this.pointerElement.style.left=(root.offsetWidth-this.pointerElement.offsetWidth)/2-offsetLeft+"px";else if(canPlaceLeft())console.debug("Placing left"),root.style.top=elem_top+"px",root.style.left=elem_left-root.offsetWidth-20+"px",this.pointerElement.classList.add("right"),this.pointerElement.style.top=(root.offsetHeight-this.pointerElement.offsetHeight)/2+"px",this.pointerElement.style.left="0px";else{if(!canPlaceRight())throw new Error("Could not find a suitable location to put element");console.debug("Placing right"),root.style.top=elem_top+"px",root.style.left=elem_left-root.offsetWidth-20+"px",this.pointerElement.classList.add("right"),this.pointerElement.style.top=elem_left+element.offsetWidth+20+"px",this.pointerElement.style.left=root.offsetWidth+"px"}root.style.opacity="1",this.openListeners.forEach(fn=>{fn()})}}